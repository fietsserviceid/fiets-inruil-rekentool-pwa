<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inruilwaarde Fietsen</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#0078D7">
  <link rel="stylesheet" href="./styles.css">
  <style>
    .license-overlay { position: fixed; inset: 0; background: #0b0c0dE6; color:#fff; z-index: 9999; display:flex; align-items:center; justify-content:center; padding:24px; }
    .license-card { width:min(960px, 100%); background:#fff; color:#111; border-radius:12px; box-shadow: 0 10px 40px rgba(0,0,0,.4); overflow:hidden; }
    .license-card header { padding:16px 20px; background:#0078D7; color:#fff; display:flex; align-items:center; gap:12px; }
    .license-card header img { height:36px; width:auto; object-fit:contain; }
    .license-body { padding: 20px; display:grid; grid-template-columns: 1fr 1fr; gap:20px; }
    .license-body h3 { margin-top:0; }
    .license-panel { border:1px solid #e5e5e5; border-radius:10px; padding:16px; }
    .license-panel label { display:block; font-weight:600; margin:10px 0 6px; }
    .license-panel input, .license-panel textarea, .license-panel select { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; font: inherit; }
    .license-panel .row { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .license-actions { margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; }
    .btn { background:#0078D7; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600; text-decoration:none; display:inline-block; }
    .btn.secondary { background:#f3f4f6; color:#111; }
    .small { font-size:12px; color:#555; }
    .muted { color:#6b7280; }
    .hint-ok { color:#059669; font-weight:600; }
    .hint-warn { color:#b45309; font-weight:600; }
    @media (max-width: 820px){ .license-body{ grid-template-columns:1fr; } }
    #licenseBanner { display:none; background:#fff7ed; border:1px solid #fed7aa; color:#7c2d12; padding:8px 12px; border-radius:8px; margin: 10px 0; }
  </style>
</head>
<body>
  <header>
    <img src="logofietsserviceidtransparant-ezgif.com-resize.png" alt="Fiets Service ID" style="height:50px; width:auto; margin-right:12px; object-fit:contain;">
    <h1>Inruilwaarde-calculator</h1>
    <div id="licenseBanner"></div>
    <button id="installBtn" hidden>Installeer app</button>
  </header>

  <main>
    <section class="card">
      <h2>Invoer</h2>
      <div class="grid">
        <label>Type fiets
          <select id="typeSelect"></select>
        </label>
        <label>Merk
          <select id="brandSelect"></select>
        </label>
        <label>Staat
          <select id="stateSelect"></select>
        </label>
        <label id="accuStateWrap">Accustaat
          <select id="accuStateSelect"></select>
        </label>
        <label>Heeft accu?
          <select id="hasAccuSelect">
            <option value="auto" selected>Automatisch (per type)</option>
            <option value="ja">Ja</option>
            <option value="nee">Nee</option>
          </select>
        </label>
        <label>Leeftijd (0–15 jaar)
          <input id="ageInput" type="number" min="0" max="15" value="5" />
        </label>
        <label>Nieuwprijs / Aanschafprijs (€)
          <input id="priceInput" type="number" min="0" step="1" placeholder="Laat leeg voor referentieprijs" />
        </label>
        <div class="hint" id="refPriceHint"></div>
      </div>
      <button id="calcBtn">Bereken inruilwaarde</button>
    </section>

    <section class="card" id="resultCard" hidden>
      <h2>Resultaat</h2>
      <div class="result-line"><span>Inruilwaarde</span><strong><span id="resultValue">€ 0</span></strong></div>
      <details>
        <summary>Toelichting en factoren</summary>
        <ul>
          <li>Leeftijdsfactor: <span id="factorAge"></span></li>
          <li>Conditiefactor: <span id="factorState"></span></li>
          <li>Accufactor: <span id="factorAccu"></span></li>
          <li>Merkfactor: <span id="factorBrand"></span></li>
        </ul>
      </details>
      <div class="actions">
        <button id="printOfferBtn">Maak offerte (print/pdf)</button>
      </div>
    </section>

    <section class="card" id="offerCard">
      <h2>Offerte – Inruilvoorstel</h2>
      <div class="offer-grid">
        <label>Naam Klant: <input id="offerName" placeholder="Naam klant"></label>
        <div class="kv">
          <div>Type fiets:</div><div id="offerType"></div>
          <div>Merk:</div><div id="offerBrand"></div>
          <div>Staat:</div><div id="offerState"></div>
          <div>Leeftijd:</div><div id="offerAge"></div>
        </div>
        <div class="offer-total">Inruilprijs: <strong id="offerTotal">€ 0</strong></div>
        <p class="small">Deze inruilwaarde is tot stand gekomen op basis van type fiets, leeftijd en algemene staat. Dit voorstel is indicatief en onder voorbehoud van fysieke inspectie.</p>
        <div class="kv"><div>Datum:</div><div id="offerDate"></div></div>
        <div class="signatures">
          <div>Handtekening klant: ____________________________</div>
          <div>Handtekening dealer: ____________________________</div>
        </div>
        <div class="actions no-print"><button onclick="window.print()">Print / Exporteer PDF</button></div>
      </div>
    </section>
  </main>

  <footer>
    <small>© <span id="year"></span> Inruilwaarde Fietsen By FsiD BV</small><br>
    <small style="font-size: 11px; color: #666;">Disclaimer: Fiets Service ID is niet aansprakelijk voor de weergegeven inruilprijs. Alle getoonde waarden zijn indicatief. De uiteindelijke inruilprijs wordt uitsluitend bepaald door de dealer.</small>
    <div class="small muted" id="licenseFooter"></div>
  </footer>

  <!-- Licentie overlay -->
  <div id="licenseGate" class="license-overlay" hidden>
    <div class="license-card" role="dialog" aria-labelledby="licenseTitle" aria-modal="true">
      <header>
        <img src="logofietsserviceidtransparant-ezgif.com-resize.png" alt="Fiets Service ID">
        <div>
          <h2 id="licenseTitle" style="margin:0">Licentie vereist</h2>
          <div class="small" id="licenseSubtitle">Activeer met installatiecode of vraag een code aan (€ <span id="licensePriceHeader">99,00</span> p/j ex. btw).</div>
        </div>
      </header>
      <div class="license-body">
        <div class="license-panel">
          <h3>Ik heb een installatiecode</h3>
          <label>Installatiecode</label>
          <input id="licCodeInput" placeholder="bijv. FSID-ABCD-EFGH-JKLM" autocomplete="one-time-code">
          <div class="license-actions">
            <button class="btn" id="activateLicBtn" onclick="activateLicenseFromInput()">Activeer</button>
            <button class="btn secondary" id="pasteLicBtn" type="button" onclick="pasteFromClipboard()">Plakken</button>
          </div>
          <p class="small muted">Na activatie is de licentie 12 maanden geldig op dit apparaat (PWA).</p>
          <div id="licMsg" class="small"></div>
        </div>
        <div class="license-panel">
          <h3>Geen code? Vraag er één aan</h3>
          <div class="row">
            <div>
              <label>Bedrijfsnaam</label>
              <input id="licBedrijfsnaam" placeholder="Uw bedrijfsnaam">
            </div>
            <div>
              <label>Contactpersoon</label>
              <input id="licContact" placeholder="Naam contactpersoon">
            </div>
          </div>
          <div class="row">
            <div>
              <label>E‑mail</label>
              <input id="licEmail" type="email" placeholder="naam@bedrijf.nl">
            </div>
            <div>
              <label>Telefoon</label>
              <input id="licTel" type="tel" placeholder="06…">
            </div>
          </div>
          <label>Adres</label>
          <input id="licAdres" placeholder="Straat en huisnummer">
          <div class="row">
            <div>
              <label>Postcode</label>
              <input id="licPostcode" placeholder="1234 AB">
            </div>
            <div>
              <label>Plaats</label>
              <input id="licPlaats" placeholder="Plaats">
            </div>
          </div>
          <div class="row">
            <div>
              <label>KvK-nummer (optioneel)</label>
              <input id="licKvK" placeholder="KvK">
            </div>
            <div>
              <label>BTW-nummer (optioneel)</label>
              <input id="licBTW" placeholder="BTW">
            </div>
          </div>
          <div class="license-actions">
            <!-- MAILTO-LINK: echte <a> zodat user-gesture gegarandeerd is -->
            <a class="btn" id="requestLicBtn" href="#" onclick="requestLicenseEmail()">Aanvraag e‑mail opstellen</a>
            <button class="btn secondary" id="saveDraftBtn" type="button" onclick="saveApplicantDraft()">Gegevens onthouden</button>
          </div>
          <p class="small muted">We genereren een e‑mail met uw NAW‑gegevens en het verzoek om een installatiecode voor een 1‑jarige licentie (€ <span id="licensePriceBody">99,00</span> ex. btw).</p>
        </div>
      </div>
      <!-- geen verborgen anchor meer nodig; we gebruiken een echte <a> als knop -->
    </div>
  </div>

  <script src="./app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js');
      });
    }
  </script>
</body>
</html>